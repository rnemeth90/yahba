package report

import (
	"sort"
	"time"
)

// Helper function to calculate latency metrics
func (r *Report) CalculateLatencyMetrics(latencies []time.Duration, totalLatency time.Duration, totalRequests int) Latency {
	if totalRequests == 0 {
		return r.Latency
	}

	// Sort latencies to compute percentiles
	sort.Slice(latencies, func(i, j int) bool {
		return latencies[i] < latencies[j]
	})

	// Calculate min, max, and average
	minLatency := latencies[0]
	maxLatency := latencies[len(latencies)-1]
	avgLatency := totalLatency / time.Duration(totalRequests)

	// Calculate percentiles
	p50 := latencies[len(latencies)*50/100]
	p95 := latencies[len(latencies)*95/100]
	p99 := latencies[len(latencies)*99/100]

	return Latency{
		Min: formatDuration(minLatency),
		Max: formatDuration(maxLatency),
		Avg: formatDuration(avgLatency),
		P50: formatDuration(p50),
		P95: formatDuration(p95),
		P99: formatDuration(p99),
	}
}

// Format duration into a readable string
func formatDuration(d time.Duration) string {
	return fmt.Sprintf("%v", d)
}
